{
  "file_analysis": {
    "filename": "gui_multi_estate_ffb_analysis.py",
    "description": "GUI application for multi-estate FFB scanner analysis with transaction verification and reporting",
    "main_class": "MultiEstateFFBAnalysisGUI",
    "dependencies": [
      "tkinter",
      "pandas", 
      "firebird_connector",
      "reportlab",
      "tkcalendar",
      "json",
      "datetime",
      "threading",
      "os"
    ]
  },
  "sql_queries": {
    "employee_mapping_query": {
      "method": "get_employee_mapping",
      "query": "SELECT DISTINCT EMPID, EMPNAME FROM EMPLOYEE",
      "purpose": "Retrieve employee ID to name mapping for all employees",
      "returns": "Dictionary mapping employee IDs to names"
    },
    "divisions_query": {
      "method": "get_divisions", 
      "query_template": "SELECT DISTINCT DIVID, DIVNAME FROM {table_name}",
      "dynamic_tables": "FFBSCANNERDATA{month:02d} (e.g., FFBSCANNERDATA05 for May)",
      "purpose": "Get distinct divisions and their names from monthly FFB scanner tables",
      "date_range_dependent": true,
      "returns": "List of tuples (division_id, division_name)"
    },
    "ffb_scanner_data_query": {
      "method": "analyze_division",
      "base_query": "SELECT * FROM {table_name} WHERE DIVID = ? ORDER BY ID, TRANSNO",
      "dynamic_tables": "FFBSCANNERDATA{month:02d}",
      "filters": {
        "division_filter": "DIVID = ?",
        "may_status_filter": "TRANSSTATUS = 704 (applied only for May when calculating differences)"
      },
      "purpose": "Retrieve all FFB scanner transactions for a specific division",
      "processing": "Handles duplicates based on ID and TRANSNO, processes transaction-by-transaction",
      "returns": "Complete transaction data for analysis"
    }
  },
  "data_processing_workflow": {
    "main_analysis_flow": {
      "entry_point": "start_analysis",
      "steps": [
        {
          "step": 1,
          "method": "run_analysis",
          "description": "Validates inputs and initiates threaded analysis"
        },
        {
          "step": 2,
          "method": "analyze_estate", 
          "description": "Processes each selected estate individually"
        },
        {
          "step": 3,
          "method": "get_employee_mapping",
          "description": "Retrieves employee ID to name mapping"
        },
        {
          "step": 4,
          "method": "get_divisions",
          "description": "Gets divisions for the date range"
        },
        {
          "step": 5,
          "method": "analyze_division",
          "description": "Analyzes each division's FFB scanner data"
        },
        {
          "step": 6,
          "method": "create_pdf_report",
          "description": "Generates comprehensive PDF report"
        }
      ]
    },
    "division_analysis_process": {
      "method": "analyze_division",
      "key_processing_steps": [
        {
          "step": "data_retrieval",
          "description": "Query FFB scanner data for specific division from monthly tables"
        },
        {
          "step": "duplicate_handling", 
          "description": "Process duplicates based on ID and TRANSNO combinations"
        },
        {
          "step": "employee_categorization",
          "description": "Categorize transactions by employee role (Kerani, Mandor, Asisten)"
        },
        {
          "step": "verification_analysis",
          "description": "Calculate verification rates and identify differences"
        },
        {
          "step": "difference_calculation",
          "description": "Compare fields between Kerani and Mandor/Asisten transactions"
        }
      ],
      "comparison_fields": [
        "RIPEBCH",
        "UNRIPEBCH", 
        "BLACKBCH",
        "ROTTENBCH",
        "LONGSTALKBCH",
        "RATDMGBCH",
        "LOOSEFRUIT"
      ]
    }
  },
  "employee_mapping_system": {
    "source_table": "EMPLOYEE",
    "mapping_structure": {
      "key": "EMPID",
      "value": "EMPNAME"
    },
    "usage": "Maps employee IDs to names for display in reports and analysis",
    "caching": "Loaded once per estate analysis for performance"
  },
  "division_handling": {
    "dynamic_table_generation": {
      "pattern": "FFBSCANNERDATA{month:02d}",
      "examples": [
        "FFBSCANNERDATA01 (January)",
        "FFBSCANNERDATA05 (May)",
        "FFBSCANNERDATA12 (December)"
      ]
    },
    "division_identification": {
      "fields": ["DIVID", "DIVNAME"],
      "uniqueness": "DISTINCT query ensures no duplicate divisions"
    }
  },
  "special_processing_rules": {
    "may_adjustments_excluded": {
      "note": "Analysis excludes May adjustments as requested",
      "implementation": "STATUS_704 filter is noted but not detailed in extraction"
    },
    "transaction_verification": {
      "method": "Compares Kerani transactions with Mandor/Asisten duplicates",
      "verification_criteria": "Presence of duplicate TRANSNO with different employee roles"
    },
    "difference_detection": {
      "comparison_logic": "Field-by-field comparison between Kerani and Mandor/Asisten records",
      "fields_compared": 7,
      "tolerance": "Exact match required (no tolerance for differences)"
    }
  },
  "output_generation": {
    "pdf_report": {
      "method": "create_pdf_report",
      "features": [
        "Company header with logo",
        "Detailed transaction analysis table",
        "Employee performance metrics",
        "Verification rate calculations",
        "Color-coded role identification",
        "Summary statistics"
      ],
      "file_naming": "Laporan_Kinerja_Kerani_Mandor_Asisten_{period}_{timestamp}.pdf",
      "location": "reports/ directory"
    },
    "data_structure": {
      "estate_level": "Individual estate analysis results",
      "division_level": "Division-specific metrics and employee details",
      "employee_level": "Individual employee transaction counts and verification rates"
    }
  },
  "configuration_management": {
    "config_file": "config.json",
    "stored_data": [
      "estate_paths (database file paths)",
      "last_selected_estates",
      "window_geometry",
      "ui_state"
    ],
    "persistence": "Automatically saves and loads user preferences"
  },
  "database_connectivity": {
    "connector_class": "FirebirdConnector",
    "connection_per_estate": true,
    "transaction_handling": "Auto-commit for read operations",
    "error_handling": "Try-catch blocks with user notification"
  },
  "performance_considerations": {
    "threading": "Analysis runs in separate thread to prevent UI freezing",
    "progress_tracking": "Real-time progress updates during analysis",
    "memory_management": "Processes estates sequentially to manage memory usage",
    "query_optimization": "Uses parameterized queries and appropriate indexing"
  },
  "key_metrics_calculated": {
    "verification_rate": "Percentage of Kerani transactions that have been verified by Mandor/Asisten",
    "employee_transaction_counts": "Total transactions per employee by role",
    "difference_counts": "Number of discrepancies found in verified transactions",
    "division_summaries": "Aggregated statistics per division",
    "grand_totals": "Overall statistics across all selected estates"
  }
}